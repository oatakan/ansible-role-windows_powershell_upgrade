---

- name: check os version
  ansible.builtin.raw: (Get-Item -Path "$env:SystemRoot\System32\kernel32.dll").VersionInfo.ProductVersion
  changed_when: false
  check_mode: false
  ignore_errors: true
  register: find_os_version

- name: set ansible_kernel
  ansible.builtin.set_fact:
    ansible_kernel: "{{ find_os_version.stdout | trim | regex_replace('[^A-Za-z0-9.]', '') }}"

- name: debug ansible_kernel
  ansible.builtin.debug:
    msg: "ansible_kernel: {{ ansible_kernel }}"

- name: set ansible_distribution_major_version
  ansible.builtin.set_fact:
    ansible_distribution_major_version: "{{ ansible_kernel.split('.')[0] | int }}"

- name: debug ansible_distribution_major_version
  ansible.builtin.debug:
    msg: "ansible_distribution_major_version: {{ ansible_distribution_major_version }}"

- name: check powershell version (1/2)
  ansible.builtin.raw: Write-Host "$($psversiontable.psversion.major).$($psversiontable.psversion.minor)"
  changed_when: false
  check_mode: false
  ignore_errors: true
  register: powershell_current_version

- name: set installed powershell version (1/2)
  ansible.builtin.set_fact:
    ansible_powershell_version: "{{ powershell_current_version.stdout | trim | regex_replace('[^A-Za-z0-9.]', '') | int }}"

- name: debug ansible_powershell_version (1/2)
  ansible.builtin.debug:
    msg: "ansible_powershell_version: {{ ansible_powershell_version }}"

- name: debug powershell target version
  ansible.builtin.debug:
    msg: "target powershell version: {{ powershell_target_version }}"
